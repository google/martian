<dom-module id="om-message-search">
  <template>
    <style is="custom-style">
      :host {
        @apply(--layout-fit);

        --paper-toolbar-background: #fefefe;
        --paper-toolbar-color: var(--paper-grey-700, #aaa);

        top: 0;
      }

      #message-search {
        @apply(--shadow-elevation-2dp);
      }

      #message-search-input {
        @apply(--layout-flex);

        background: transparent;
        border-width: 0;
        font-size: 16px;
        outline: none;
        width: 100vw;
      }
    </style>
    <paper-toolbar id="message-search">
      <paper-icon-button id="message-search-back" icon="arrow-back" on-tap="_hideSearch"></paper-icon-button>
      <input is="iron-input"
        id="message-search-input"
        placeholder="regex search"
        on-keyup="_checkForEnter"
        bind-value="{{partialQuery}}">
      <paper-icon-button
        hidden$="[[_blank(partialQuery)]]"
        icon="help-outline"></paper-icon-button>
      <paper-icon-button
        hidden$="[[!_blank(partialQuery)]]"
        on-tap="_resetQuery"
        icon="close"></paper-icon-button>
    </paper-toolbar>
  </template>
  <script>
    Polymer({
      is: 'om-message-search',
      properties: {
        query: {
          type: String,
          value: '',
          notify: true,
        },
        partialQuery: {
          type: String,
          value: '',
        },
      },
      behaviors: [
        Polymer.IronOverlayBehavior,
        Polymer.IronFitBehavior,
      ],
      _hideSearch: function() {
        this.async(function() {
          this.close(); 
        }, 100);
      },
      _resetQuery: function() {
        this.async(function() {
          this.partialQuery = '';
        }, 100);
      },
      _blank: function(partialQuery) {
        return !!partialQuery;
      },
      _checkForEnter: function(key) {
        if(key.keyCode != 13) {
          return;
        }
        this.submitQuery();
      },
      submitQuery: function() {
        this.query = this.partialQuery;
        this._hideSearch();
      },
    });
  </script>
</dom-module>
